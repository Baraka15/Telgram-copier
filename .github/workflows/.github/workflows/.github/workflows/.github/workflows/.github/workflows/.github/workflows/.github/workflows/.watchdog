name: Watchdog Restart

on:
  workflow_run:
    workflows: ["Bot Runner"]
    types:
      - completed

concurrency:
  group: telegram-watchdog
  cancel-in-progress: false

jobs:
  retrigger:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest

    steps:
      - name: Install GitHub CLI
        run: |
          sudo apt update
          sudo apt install gh -y

      - name: Apply Restart Cooldown
        run: |
          echo "Waiting before restart..."
          sleep 20

      - name: Restart Bot Runner
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Bot Runner failed. Restarting..."
          gh workflow run "Bot Runner"
